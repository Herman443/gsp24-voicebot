<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Text To Speech</title>
</head>
<body>
    <input type="text" id="input" placeholder="Enter text" />
    <button id="sendButton" onclick="sendMessage()">Send Message</button>
    <button id="stopButton" onclick="stopChat()">Stop Chat</button>
    <div id="responseContainer"></div>
    <audio id="audio" controls autoplay>
        <source src="" />
    </audio>
    <script src="https://www.WebRTC-Experiment.com/RecordRTC.js"></script>
    <script>
        var protocol = window.location.protocol === "http:" ? "ws" : "wss";
        let ws = new WebSocket(protocol + "://" + window.location.host + "/web/websocket/text");
        var audio = document.getElementById("audio");
        var input = document.getElementById("input");

        function sendMessage() {
            if (ws && ws.readyState === WebSocket.OPEN) {
                let message = input.value;
                ws.send(message);
                document.getElementById("responseContainer").innerHTML += `<p>${message}</p>`;
                input.value = ''; 
            }
        }

        input.addEventListener("keypress", function(event) {
            if (event.key === "Enter") {
                event.preventDefault();
                sendMessage();
            }
        });

        ws.onmessage = event => {
          
            let responseContainer = document.getElementById("responseContainer");
            if (typeof event.data === "string") {
                responseContainer.innerHTML += `<p>${event.data}</p>`;
            } else if (event.data instanceof Blob) {
                blobToBase64(event.data).then(b64 => {
                    audio.src = "data:audio/x-wav;base64," + b64;
                    audio.play();
                });
            }
        };

        function blobToBase64(blob) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.readAsDataURL(blob);
                reader.onload = () => {
                    const base64String = reader.result.split(",")[1];
                    resolve(base64String);
                };
                reader.onerror = error => reject(error);
            });
        }

        function handleDataAvailable(event) {
            if (event.size > 0) {
                blobToBase64(event).then(b64 => {
                    ws.send(b64);
                });
            }
        }


        function stopChat() {
            if (ws) {
                ws.close();
            }
        }

        ws.onopen = () => {
            console.log("WebSocket connection opened");
        };

        ws.onclose = () => {
            console.log("WebSocket connection closed");
        };
    </script>
</body>
</html>
